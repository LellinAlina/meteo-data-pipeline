name: Daily Weather ETL

on:
  schedule:
    - cron: '0 3 * * *'  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 03:00 –ø–æ UTC
  workflow_dispatch:     # –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∑–∞–ø—É—Å–∫–∞ –≤—Ä—É—á–Ω—É—é

jobs:
  run-etl:
    runs-on: ubuntu-latest

    steps:
    - name: üì• Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
      uses: actions/checkout@v3

    - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'

    - name: ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
      run: |
        echo "URL –¥–ª–∏–Ω–∞: ${#SUPABASE_URL}"
        echo "KEY –¥–ª–∏–Ω–∞: ${#SUPABASE_KEY}"
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}

    - name: üöÄ –ó–∞–ø—É—Å–∫ ETL-—Å–∫—Ä–∏–ø—Ç–∞
      env:
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: python actions_etl_weather_current_from_open_meteo.py
